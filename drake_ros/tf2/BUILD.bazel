load("@ros2//:ros_cc.bzl", "ros_cc_test")
load("//tools/lint:lint.bzl", "add_lint_tests")

# Dependencies for both static and shared libraries that will not violate ODR.
cc_library(
    name = "odr_safe_deps",
    visibility = ["//:__subpackages__"],
    deps = [
        "//core:odr_safe_deps",
        "@ros2//:geometry_msgs_cc",
        "@ros2//:rclcpp_cc",
        "@ros2//:tf2_ros_cc",
    ],
)

# TODO(sloretz) more granular targets for static linking
cc_library(
    name = "tf2",
    srcs = glob(["*.cc"]),
    hdrs = glob(
        ["*.h"],
    ),
    include_prefix = "drake_ros/tf2",
    visibility = ["//visibility:public"],
    deps = [
        ":odr_safe_deps",
        "//core",
        "@drake//geometry:scene_graph_inspector",
        "@drake//multibody/plant",
    ],
)

ros_cc_test(
    name = "test_tf_broadcaster",
    size = "small",
    srcs = ["test/test_tf_broadcaster.cc"],
    rmw_implementation = "rmw_cyclonedds_cpp",
    deps = [
        ":tf2",
        "@bazel_ros2_rules//lib/ros_environment:ros_env_cc",
        "@drake//common",
        "@drake//systems/primitives",
        "@gtest//:main",
        "@ros2//:geometry_msgs_cc",
        "@ros2//:rclcpp_cc",
        "@ros2//:tf2_ros_cc",
    ],
)

add_lint_tests()
